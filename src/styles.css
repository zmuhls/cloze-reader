@import url('https://fonts.googleapis.com/css2?family=Special+Elite&display=swap');

@tailwind base;
@tailwind components;
@tailwind utilities;

/* Typewriter Base Styles */
body {
  font-family: 'Special Elite', 'Courier New', monospace;
  color: theme('colors.typewriter-ink');
  background-color: theme('colors.aged-paper');
  background-image: theme('backgroundImage.paper-texture');
  letter-spacing: theme('letterSpacing.typewriter');
}

/* Uneven Character Effect for Typewriter Look */
.typewriter-text span {
  display: inline-block;
  --tw-uneven-y: calc(random(5) * 0.02rem - 0.04rem);
}

/* Fix for spacing between words and layout */
.typewriter-text {
  word-spacing: 0.1em; /* Slightly reduced for better fit */
  white-space: normal; /* Allow normal wrapping */
  overflow-wrap: break-word; /* Standard property for word wrapping */
  word-wrap: break-word; /* Older property for compatibility */
  line-height: 1.8; /* Maintain good line height */
  margin-bottom: 0.75rem; /* Consistent paragraph spacing */
  display: inline; /* Default to inline for spans within paragraphs */
}

/* Ensure text within the welcome overlay wraps correctly */
#welcome-overlay .typewriter-text {
  word-break: break-word; 
  overflow-wrap: break-word;
  word-wrap: break-word; 
}

/* General prose styling for responsive text */
.prose {
  max-width: 100% !important; /* Ensure it doesn't exceed container */
  width: 100%;
  overflow-wrap: break-word;
  word-wrap: break-word;
  word-break: break-word; /* Allow breaking long words if necessary */
}

/* Game area formatting for responsiveness */
#game-area {
  padding: 1rem !important;
  border-radius: 0.5rem;
  border: 1px solid rgba(0, 0, 0, 0.1);
  background-color: theme('colors.aged-paper');
  max-width: 100%; /* Ensure it uses full available width */
  overflow-x: hidden; /* Prevent horizontal scrolling */
  display: flex;
  flex-direction: column;
  min-height: 200px; /* Ensure a minimum height for content visibility */
}

/* Ensure individual words (spans) within typewriter-text flow correctly */
span.typewriter-text {
  display: inline; /* Keep spans inline to flow with text */
  margin-right: 0; /* No extra margin for individual spans */
  vertical-align: baseline; /* Align with surrounding text */
}

/* Ensure paragraphs are properly separated and wrap */
p.typewriter-text {
  display: block; /* Paragraphs should be block elements */
  margin-bottom: 1.5rem; /* Space between paragraphs */
  /* Ensure text within paragraphs also wraps correctly */
  overflow-wrap: break-word;
  word-wrap: break-word;
  word-break: break-word;
  hyphens: auto; /* Allow hyphenation for better word wrapping */
}

/* Dialogue formatting with tighter spacing */
p.typewriter-text[data-dialogue="true"] {
  margin-bottom: 0.5rem;
}

/* Make instructions stand out */
#welcome-overlay ol, #welcome-overlay ul {
  margin: 15px 0;
}

/* Typewriter Input Field Styling - Enhanced for Responsiveness */
input[type="text"].border-b-2 { /* Target specific inputs to avoid affecting others */
  font-family: 'Special Elite', 'Courier New', monospace;
  border-bottom-width: 1px; /* Keep consistent base border */
  border-bottom-style: solid;
  background-color: transparent;
  transition: all 0.2s ease;
  /* width is now set dynamically via JS using 'ch' units */
  /* min-width is set via JS to '60px' */
  max-width: 90%; /* Prevent inputs from becoming excessively wide on large screens */
  padding: 0.1rem 0.25rem; /* Adjust padding for better fit */
  margin: 0 0.15rem; /* Adjust margin */
  box-sizing: border-box; /* Include padding and border in element's total width and height */
  vertical-align: baseline; /* Align with surrounding text */
  line-height: inherit; /* Inherit line height from parent */
  font-size: inherit; /* Inherit font size */
  letter-spacing: inherit; /* Inherit letter spacing */
}

input[type="text"].border-b-2::placeholder {
  opacity: 0.6; /* Slightly more visible placeholder */
  color: theme('colors.typewriter-ink'); /* Ensure placeholder color matches theme */
  font-family: 'Special Elite', 'Courier New', monospace; /* Ensure placeholder font matches */
  letter-spacing: 0.05em; /* Match letter spacing for underscores */
}

input[type="text"].border-b-2:focus {
  outline: none;
  border-bottom-width: 2px; /* Emphasize focus */
  border-color: theme('colors.typewriter-ribbon'); /* Use ribbon color for focus */
}

/* Typewriter Cursor Animation - No changes needed here */
@keyframes typewriter-blink {
  0%, 100% { opacity: 1; }
  50% { opacity: 0; }
}

/* Apply blink to focused input, consider if ::after is best or a separate element */
/* For simplicity, this example assumes direct styling. A more robust solution might use a sibling span. */
/* input[type="text"]:focus::after {
  content: '|';
  animation: typewriter-blink 1s step-end infinite;
} */

/* Ensure hint icon aligns well with input */
.hint-info-icon {
  vertical-align: middle; /* Align icon with the middle of the text/input */
  display: inline-block; /* Ensure it behaves well with surrounding elements */
}

/* Typewriter Button Styling */
button {
  transition: all 0.2s ease;
  box-shadow: theme('boxShadow.typewriter');
  position: relative;
  overflow: hidden;
}

button:not(:disabled):active {
  transform: translateY(2px);
  box-shadow: theme('boxShadow.typewriter-pressed');
}

/* Enhanced focus states for accessibility */
button:focus-visible,
input:focus-visible,
select:focus-visible,
a:focus-visible {
  outline: none;
  box-shadow: 0 0 0 2px white, 0 0 0 4px theme('colors.typewriter-ribbon');
}

/* Button variants */
.btn-primary {
  @apply bg-typewriter-ribbon text-aged-paper font-medium rounded shadow-typewriter 
         hover:bg-opacity-90 focus:outline-none focus:ring-2 focus:ring-typewriter-ink 
         focus:ring-offset-2 transition-all min-w-[120px] min-h-[42px] 
         flex items-center justify-center;
}

.btn-secondary {
  @apply bg-aged-paper-dark text-typewriter-ink rounded border border-gray-300 
         shadow-typewriter hover:bg-aged-paper focus:outline-none focus:ring-2 
         focus:ring-typewriter-ribbon disabled:opacity-50 disabled:cursor-not-allowed 
         min-w-[120px] min-h-[42px] flex items-center justify-center transition-all;
}

/* Ripple effect for buttons */
button::after {
  content: '';
  position: absolute;
  width: 100%;
  height: 100%;
  top: 0;
  left: 0;
  pointer-events: none;
  background-image: radial-gradient(circle, #fff 10%, transparent 10.01%);
  background-repeat: no-repeat;
  background-position: 50%;
  transform: scale(10, 10);
  opacity: 0;
  transition: transform 0.3s, opacity 0.5s;
}

button:not(:disabled):active::after {
  transform: scale(0, 0);
  opacity: 0.3;
  transition: 0s;
}

/* Typewriter Paper and Section Styling */
.bg-white {
  background-color: theme('colors.aged-paper');
  border: 1px solid rgba(0, 0, 0, 0.1);
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
}

/* Ink Ribbon Effect */
.ink-ribbon-effect {
  position: relative;
}

.ink-ribbon-effect::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 100%;
  background: repeating-linear-gradient(
    to bottom,
    transparent,
    transparent 15px,
    rgba(0, 0, 0, 0.03) 15px,
    rgba(0, 0, 0, 0.03) 16px
  );
  pointer-events: none;
}

/* Header and Title Styling */
header {
  border-bottom: 1px solid rgba(0, 0, 0, 0.1);
  background-color: theme('colors.aged-paper');
  padding: 1rem;
}

#game-title {
  text-shadow: theme('textShadow.typewriter');
  letter-spacing: 0.1em;
  color: theme('colors.typewriter-ink');
}

#header-icon {
  height: 1.5em; /* Adjust size as needed */
  vertical-align: middle; /* Align with text */
  margin-right: 0.5rem; /* Space between icon and title */
  /* Optional: add subtle styling like a border or shadow if desired */
}

/* Enhance controls for typewriter look */
select, button, input[type="text"] {
  font-family: 'Special Elite', 'Courier New', monospace !important;
  letter-spacing: 0.05em !important;
}

/* Improve category select truncation */
#category-select {
  padding-right: 2rem; /* Add space for the dropdown arrow */
  max-width: 150px; /* Limit width to prevent excessive growth */
  overflow: hidden;
  text-overflow: ellipsis; /* Add ellipsis for truncated text */
  white-space: nowrap; /* Prevent wrapping */
}

/* Improve contrast for Author input placeholder */
#author-input::placeholder {
  color: theme('colors.typewriter-ink'); /* Use a contrasting color */
  opacity: 0.8; /* Make it slightly transparent */
}

/* Improve contrast for New Text button text */
#new-text-btn {
  color: theme('colors.aged-paper') !important; /* Change text color to aged paper */
}

/* Left-aligned typewriter text for analysis */
.typewriter-text.text-left {
  text-align: left;
  word-spacing: 0.2em;
  white-space: normal;
  overflow-wrap: break-word;
  word-wrap: break-word;
  line-height: 1.8;
  margin-bottom: 0.5rem;
}

/* Analysis area styling */
#analysis-area {
  margin-top: 1rem;
  display: none;
}

#analysis-area.visible {
  display: block;
}


/* Responsive header adjustments */
@media (max-width: 768px) {
  header .flex.space-x-4 {
    flex-wrap: wrap;
    gap: 0.5rem;
  }

  #round-info {
    font-size: 0.875rem;
  }
}

/* Styles for the new bibliographic area */
#bibliographic-area {
  font-family: 'Courier New', Courier, monospace; /* Match typewriter theme */
  color: #222; /* Darker ink color for better contrast */
  background-color: #fff8e1; /* Lighter aged paper background for better contrast */
  border: 1px solid #d3c6a8; /* Subtle border */
  padding: 0.1rem 0.8rem; /* Keep reduced vertical padding */
  margin-bottom: 0.5rem; /* Keep margin bottom */
  box-shadow: 1px 1px 3px rgba(0, 0, 0, 0.1); /* More subtle shadow */
  overflow-wrap: break-word; /* Ensure long titles/authors wrap */
  word-wrap: break-word; /* Ensure long titles/authors wrap */
  font-size: 1.2rem; /* Increased font size */
  line-height: 1.2; /* Adjusted line height */
}

#bibliographic-area p {
  margin: 0; /* Ensure no margin */
  padding: 0; /* Ensure no padding */
  line-height: 1.2; /* Match parent line height */
  font-size: 1.2rem; /* Increased font size */
  color: #222; /* Ensure text color is applied */
}

#bibliographic-area em {
  font-style: italic; /* Keep emphasis for title */
}

/* Improved contrast for readability */
.bg-aged-paper-dark {
  background-color: theme('colors.aged-paper-dark');
  color: theme('colors.typewriter-ink');
}

/* Input field styling for header */
header input[type="text"] {
  background-color: theme('colors.aged-paper-dark');
  border-radius: 0.25rem;
  border: 1px solid rgba(0, 0, 0, 0.2);
}


/* Additional Utility Classes */
@layer utilities {
  .text-typewriter {
    font-family: 'Special Elite', 'Courier New', monospace;
    letter-spacing: theme('letterSpacing.typewriter');
  }

  .typewriter-key {
    @apply bg-aged-paper-dark text-typewriter-ink border border-gray-300 shadow-typewriter;
  }

  .typewriter-key:active:not(:disabled) {
    @apply shadow-typewriter-pressed;
  }
}

/* Visual indicator for hinted blanks */
input[type="text"].hinted-blank {
  border-bottom-color: theme('colors.typewriter-ribbon'); /* Use a different color from the theme */
  border-bottom-style: dotted; /* Change line style */
}

/* Make buttons consistent size */
button {
  min-width: 120px;
  min-height: 42px;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  transition: all 0.2s ease;
}

/* Improved overlay styling - more compact with refined aesthetics */
#welcome-overlay {
  backdrop-filter: blur(4px);
  z-index: 1000;
  background-color: rgba(0, 0, 0, 0.5); /* Add semi-transparent black background */
}

#welcome-overlay .bg-aged-paper {
  border: 1px solid #8b5cf6;
  max-height: 88vh;
  overflow-y: auto;
  box-shadow: 0 6px 20px rgba(0, 0, 0, 0.18), 0 0 5px rgba(139, 92, 246, 0.2);
  border-radius: 8px;
  max-width: 650px;
  padding: 1.5rem !important;
}

/* More compact instruction styling */
#welcome-overlay h1 {
  margin-bottom: 1rem !important;
  font-size: 1.75rem !important;
}

#welcome-overlay .prose {
  margin-bottom: 1rem !important;
}

#welcome-overlay p {
  margin-bottom: 0.75rem !important;
}

#welcome-overlay h2 {
  margin-top: 0.75rem !important;
  margin-bottom: 0.5rem !important;
  font-size: 1.25rem !important;
}

#welcome-overlay ol, #welcome-overlay ul {
  margin-top: 0.5rem !important;
  margin-bottom: 0.5rem !important;
  list-style-position: outside;
  padding-left: 1.5rem;
}

/* Clean, minimalist instruction styling */
#welcome-overlay ol li, #welcome-overlay ul li {
  padding: 4px 0;
  margin: 6px 0;
  color: theme('colors.typewriter-ink'); /* Use typewriter ink color */
  font-weight: 400; /* Reduce font weight */
  font-size: 1rem !important; /* Adjust font size */
  border: none; /* Remove border */
  background-color: transparent; /* Remove background color */
  box-shadow: none; /* Remove box shadow */
  list-style: none; /* Remove default list styles */
  padding-left: 0; /* Remove default padding */
}

#welcome-overlay ol li::before, #welcome-overlay ul li::before {
  content: '> '; /* Add minimalist symbol */
  color: theme('colors.typewriter-ribbon'); /* Color the symbol */
  font-weight: bold;
  margin-right: 0.5rem;
}


#welcome-overlay button {
  min-width: 150px;
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15), 0 0 0 1px rgba(139, 92, 246, 0.2);
  padding: 0.5rem 1.25rem;
  transform: translateY(0);
  transition: all 0.2s ease;
}

#welcome-overlay button:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2), 0 0 0 1px rgba(139, 92, 246, 0.3);
}

/* Normalize header controls */
header {
  display: flex !important;
  flex-direction: row !important;
  flex-wrap: wrap;
  justify-content: space-between;
  align-items: center;
}

/* Styling for the right-aligned button group in the header */
header .flex.flex-wrap.justify-end.items-center {
  display: flex !important;
  gap: 0.75rem;
  align-items: center;
  justify-content: flex-end;
  margin-left: auto;
}


@media (max-width: 768px) {
  header {
    flex-direction: column; /* Stack title and buttons vertically */
  }
  header .flex.items-center.mb-4 { /* Title group */
    margin-bottom: 0.5rem; /* Reduce margin if stacking */
  }
  header .flex.justify-end.items-center { /* Button group */
    width: 100%;
    justify-content: space-around; /* Space out buttons if they wrap */
    gap: 0.5rem;
  }

  header .flex.justify-end.items-center button {
    flex-grow: 1; /* Allow buttons to grow and fill space */
    min-width: 100px; /* Ensure buttons are not too small */
  }

  /* Ensure buttons in the header and game controls are responsive */
  button, select, input[type="text"] {
    font-size: 0.9rem;
    padding: 8px 12px !important; /* Maintain consistent padding */
    box-sizing: border-box;
  }
  
  #game-controls button {
    padding: 6px 10px !important; /* Smaller padding for game controls */
    font-size: 0.85rem;
    min-width: 80px; /* Smaller min-width for game controls */
    min-height: 32px;
  }

  #round-info {
    text-align: center; /* Center round info */
    width: 100%;
    margin-top: 0.5rem; /* Add some space above round info */
    font-size: 1rem; /* Ensure round info is readable */
  }

  #category-select {
    max-width: unset; /* Remove max-width constraint */
  }
}

/* Styles for the new game controls area */
#game-controls {
  display: flex;
  justify-content: flex-end; /* Align buttons to the right */
  align-items: center;
  gap: 0.5rem; /* Space between hint and submit buttons */
  margin-top: 0.5rem; /* Space above the controls */
  min-height: 45px; /* Ensure the container has a minimum height */
  flex-shrink: 0; /* Prevent shrinking */
  position: relative; /* Ensure proper stacking context */
  z-index: 5; /* Ensure buttons appear above other content */
}

#game-controls button {
  font-size: 0.9em; /* Slightly smaller font for these buttons */
  padding: 0.35rem 0.75rem; /* Smaller padding */
  min-width: 90px; /* Adjust min-width as needed */
  min-height: 36px; /* Adjust min-height */
  opacity: 1; /* Ensure buttons are visible even when disabled */
  pointer-events: auto; /* Ensure buttons receive click events */
}

/* Ensure proper styling when disabled */
#game-controls button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

/* Styles for the container holding Submit and Continue buttons */
.game-buttons-container {
  display: flex;
  flex-direction: column;
  align-items: flex-end; /* Align items to the right */
  gap: 0.5rem; /* Space between buttons */
}


/* Ensure game area handles overflow and responsiveness */
#game-area {
  overflow-x: hidden; 
  overflow-y: auto; /* Allow vertical scroll if content exceeds height */
  overflow-wrap: break-word; 
  word-break: break-word; 
  flex-grow: 1; /* Allow game area to take available space */
  min-height: 30vh; /* Ensure it has some minimum height */
}

/* Center round-info text */
#round-info {
  text-align: center;
  display: block; 
  width: 100%;
  margin-top: 0.5rem; 
}

/* Responsive base layout and mobile zoom prevention */
html {
  -webkit-text-size-adjust: 100%; /* Prevent iOS text size adjustment */
  -ms-text-size-adjust: 100%; /* Prevent IE text size adjustment */
}

body {
  min-width: 320px; /* Minimum width for very small devices */
}

/* Prevent zoom on input focus on mobile devices */
input[type="text"], textarea {
  font-size: 16px !important; /* Setting font-size to 16px or higher often prevents auto-zoom on iOS */
}


/* Add responsive base layout */
@media screen and (max-width: 640px) { /* Adjusted breakpoint for better targeting */
  html, body {
    font-size: 15px; /* Slightly adjusted base font for small-medium screens */
  }
  
  main#app { /* Target the main app container for padding */
    padding: 0.75rem; /* Reduce padding on smaller screens */
  }
  
  button {
    min-width: 90px; 
    min-height: 38px; 
    font-size: 0.875rem; /* Slightly smaller font for buttons */
  }

  #game-area {
    padding: 0.75rem !important; /* Reduce padding inside game area */
  }

  input[type="text"].border-b-2 {
    /* Ensure inputs don't get too small or too large */
    min-width: 50px; 
    max-width: 80%; /* Allow them to shrink but not exceed a certain percentage */
  }
}

@media screen and (max-width: 480px) {
  html, body {
    font-size: 14px; 
  }
  
  main#app {
    padding: 0.5rem; 
  }

  button {
    min-width: 80px; 
    min-height: 36px; 
  }
   input[type="text"].border-b-2 {
    min-width: 40px;
  }
}

/* Add landscape orientation support */
@media screen and (max-height: 480px) and (orientation: landscape) {
  #welcome-overlay .bg-aged-paper {
    max-height: 85vh; /* Adjust for landscape */
    width: 90%; 
    padding: 1rem !important; 
  }
  
  button {
    min-height: 32px; 
    font-size: 0.8rem;
  }
  
  #game-area, #teaching-area {
    padding: 0.5rem !important; 
    min-height: 25vh;
  }
  
  header .flex.space-x-4 {
    flex-direction: row !important; 
    flex-wrap: wrap;
    justify-content: center;
  }
  
  header .flex.space-x-4 > * {
    width: auto !important; 
    margin-right: 0.5rem;
  }
  input[type="text"].border-b-2 {
    font-size: 15px !important; /* Slightly smaller to fit landscape */
  }
}

/* Settings Footer Styles - Compact & Minimalist */
.settings-footer {
  margin-top: 0;
  border-top: none;
  padding-top: 0;
}

.settings-header {
  cursor: pointer;
  background-color: theme('colors.aged-paper-dark');
  color: theme('colors.typewriter-ink');
  padding: 4px 0;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1.1rem;
  transition: background-color 0.2s ease;
  height: 24px;
}

.minimalist-header {
  height: 24px;
}

.settings-header:hover {
  background-color: theme('colors.aged-paper');
}

.settings-icon {
  opacity: 0.8;
  font-size: 1.1rem;
  margin-right: 5px;
}

.settings-content {
  padding: 10px 15px;
  background-color: theme('colors.aged-paper-light');
  border-top: 1px solid rgba(0, 0, 0, 0.05);
  max-height: 0;
  overflow: hidden;
  opacity: 0;
  transition: max-height 0.3s ease-out, opacity 0.3s ease-out;
}

.settings-footer.expanded .settings-content {
  max-height: 500px;
  opacity: 1;
}

/* Add print styles for better printing */
@media print {
  body {
    background: white !important;
    color: black !important;
  }
  
  #welcome-overlay {
    display: none !important; /* Hide overlay when printing */
  }
  
  button, header input, select {
    display: none !important; /* Hide controls when printing */
  }
  
  #game-area, #teaching-area, #bibliographic-area {
    border: none !important;
    box-shadow: none !important;
    padding: 0 !important;
    margin: 1rem 0 !important;
  }
  
  .typewriter-text {
    font-family: 'Times New Roman', Times, serif !important; /* Better print font */
    color: theme('colors.typewriter-ink');
  }
}
